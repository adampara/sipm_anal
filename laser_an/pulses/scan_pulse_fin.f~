      REAL FUNCTION scan_pulse_fin()
*********************************************************
*                                                       *
* This file was generated by HUWFUN.                    *
*                                                       *
*********************************************************
*
*     Ntuple Id:      60   
*     Ntuple Title:   Pulses
*     Creation:       21/07/2014 16.39.59
*
*********************************************************
*
      LOGICAL         CHAIN
      CHARACTER*128   CFILE
      INTEGER         IDNEVT,NCHEVT,ICHEVT
      REAL            OBS(13)
*
      COMMON /PAWIDN/ IDNEVT,OBS
      COMMON /PAWCHN/ CHAIN, NCHEVT, ICHEVT
      COMMON /PAWCHC/ CFILE
*
*--   Ntuple Variable Declarations
*
      REAL xlgate(500),gate(10),start,q(10),q_r1(10),q_r2(10),q_r3(10)
     + ,q_r4(10),t(100),t_bef(100),t_aft(100),chi_peak(100)
     + ,chi_3tau(100),ampl(100),wid66(100),wid50(100),wid33(100)
     + ,q_bef(100),pulse(200,100),puls_q(200)
      INTEGER Nwf,N_puls,n_puls_nq
*
      COMMON /PAWCR4/ Nwf,xlgate,gate,start,q,q_r1,q_r2,q_r3,q_r4,N_puls
     + ,n_puls_nq,t,t_bef,t_aft,chi_peak,chi_3tau,ampl,wid66,wid50,wid33
     + ,q_bef,pulse,puls_q
*
*
*--   Enter user code here
*
c      print *,nwf

      do i = 1,N_puls


         print *,nwf,i,ihist,ampl(i)
         if(ampl(i).gt.0.025.and.ampl(i).lt.0.028) then
c         if(q_bef(i).gt.3.0) then
            ihist = ihist + 1
            print *,ihist
            do j=1,200
               call hfill(100+ihist,j+0.5,0,pulse(j,i))
            enddo

         endif

       enddo

         if(ihist.gt.100) stop
      scan_pulse_fin = 1.
*
      END
